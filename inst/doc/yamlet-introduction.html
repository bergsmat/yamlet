<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Tim Bergsma" />

<meta name="date" content="2024-11-25" />

<title>An Introduction to Yamlet</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<style type="text/css">
.Rtable1 table, table.Rtable1 {
font-family: "Arial", Arial, sans-serif;
font-size: 10pt;
border-collapse: collapse;
padding: 0px;
margin: 0px;

}
.Rtable1 td {
white-space:nowrap;
}
.Rtable1 th, .Rtable1 td {
border: 0;
text-align: center;
padding: 0.5ex 1.5ex;
margin: 0px;
}
.Rtable1 thead>tr:first-child>th {
border-top: 2pt solid black;
}
.Rtable1 thead>tr:last-child>th {
border-bottom: 1pt solid black;
}
.Rtable1 tbody>tr:last-child>td {
border-bottom: 2pt solid black;
}
.Rtable1 th.grouplabel {
padding-left: 0;
padding-right: 0;
}
.Rtable1 th.grouplabel>div {
margin-left: 1.5ex;
margin-right: 1.5ex;
border-bottom: 1pt solid black;
}
.Rtable1 th.grouplabel:last-child>div {
margin-right: 0;
}
.Rtable1 .rowlabel {
text-align: left;
padding-left: 2.5ex;
}
.Rtable1 .firstrow.rowlabel {
padding-left: 0.5ex;
font-weight: bold;
}

.Rtable1-zebra tbody tr:nth-child(odd) {
background-color: #eee;
}

table.Rtable1-times {
font-family: "Times New Roman", Times, serif;
}

.Rtable1-shade th {
background-color: #ccc;
}

.Rtable1-grid th, .Rtable1-grid td {
border-left: 1pt solid black;
border-right: 1pt solid black;
}
.Rtable1-grid thead>tr:first-child>th {
border-top: 1pt solid black;
}
.Rtable1-grid thead>tr:last-child>th {
border-bottom: 1pt solid black;
}
.Rtable1-grid tbody>tr:last-child>td {
border-bottom: 1pt solid black;
}
.Rtable1-grid .firstrow, .Rtable1-grid .firstrow ~ td {
border-top: 1pt solid black;
}
.Rtable1-grid th.grouplabel>div {
margin-left: 0;
margin-right: 0;
border-bottom: 0;
}

.Rtable1-center td.rowlabel, .Rtable1-center td.firstrow.rowlabel {
font-weight: bold;
text-align: center;
padding: 0.5ex 1.5ex;
}

.Rtable1 .Rtable1-footnote {
font-size: smaller;
padding: 0px;
margin: 0px;
text-align: left;
white-space: normal;
}
</style>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">An Introduction to Yamlet</h1>
<h4 class="author">Tim Bergsma</h4>
<h4 class="date">2024-11-25</h4>


<div id="TOC">
<ul>
<li><a href="#motivation" id="toc-motivation">Motivation</a></li>
<li><a href="#writing-yamlet" id="toc-writing-yamlet">Writing Yamlet</a>
<ul>
<li><a href="#manual-method" id="toc-manual-method">Manual
Method</a></li>
<li><a href="#automatic-method" id="toc-automatic-method">Automatic
Method</a></li>
</ul></li>
<li><a href="#reading-and-binding-yamlet-in-r" id="toc-reading-and-binding-yamlet-in-r">Reading and Binding Yamlet in
R</a></li>
<li><a href="#extracting-and-writing-yamlet-to-storage" id="toc-extracting-and-writing-yamlet-to-storage">Extracting and Writing
Yamlet to Storage</a></li>
<li><a href="#coordinated-input-and-output" id="toc-coordinated-input-and-output">Coordinated Input and
Output</a></li>
<li><a href="#using-yamlet-metadata" id="toc-using-yamlet-metadata">Using Yamlet Metadata</a>
<ul>
<li><a href="#example-figure" id="toc-example-figure">Example
Figure</a></li>
<li><a href="#example-table" id="toc-example-table">Example
Table</a></li>
</ul></li>
<li><a href="#caveat" id="toc-caveat">Caveat</a></li>
<li><a href="#reminder" id="toc-reminder">Reminder</a></li>
<li><a href="#conclusion" id="toc-conclusion">Conclusion</a></li>
</ul>
</div>

<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>R datasets of modest size are routinely stored as flat files and
retrieved as data frames. Unfortunately, the classic storage formats
(comma delimited, tab delimited) do not have obvious mechanisms for
storing data <em>about</em> the data: i.e., metadata such as column
labels, units, and meanings of categorical codes. In many cases we hold
such information in our heads and hard-code it in our scripts as axis
labels, figure legends, or table enhancements. That’s probably fine for
simple cases but does not scale well in production settings where the
same metadata is re-used extensively. Is there a better way to store,
retrieve, and bind table metadata for consistent reuse?</p>
</div>
<div id="writing-yamlet" class="section level2">
<h2>Writing Yamlet</h2>
<p><strong>yamlet</strong> is a storage format for table metadata,
implemented as an R package.<br />
It was designed to be:</p>
<ul>
<li>easy to edit</li>
<li>easy to import</li>
<li>open-ended</li>
</ul>
<p>Although intended mainly to document (or pre-specify!) data column
labels and units, there are few restrictions on the types of metadata
that can be stored. In fact, the only real restriction is that the
stored form must be valid <a href="https://yaml.org/spec/1.2/spec.html">yaml</a>. Below, we use
<strong>yamlet</strong> to indicate the paradigm or package, and
<code>yamlet</code> to indicate stored instances.</p>
<div id="manual-method" class="section level3">
<h3>Manual Method</h3>
<p>Actually, <code>yamlet</code> (think: “just a little yaml”) is a
special case of <code>yaml</code> that stores column attributes in one
record per column. For instance, to store the fact that data for an
imaginary drug trial has a column called ‘ID’, pop open a text file and
write</p>
<pre><code>ID:</code></pre>
<p>This in itself is valid <code>yaml</code>! But if you know a label to
go with ID, you can add it:</p>
<pre><code>ID: subject identifier</code></pre>
<p>If you have (or expect) a second column with units, you can add it
below.</p>
<pre><code>ID: subject identifier
CONC: concentration, ng/mL</code></pre>
<p>A couple of notes here.</p>
<ul>
<li>The first thing after a colon must be a space.</li>
<li>Whatever follows the colon-space is only One Thing.</li>
<li>That One Thing could be a <em>sequence</em> of Many Things.</li>
</ul>
<p>To get a sequence, just add square brackets. For instance, above we
have said that ‘CONC’ has the label ‘concentration, ng/mL’ but what we
really intend is that it has label ‘concentration’ and unit ‘ng/mL’ so
we rewrite it as</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]</code></pre>
<p>Now label and units are two different things. Notice we have not
explicitly named them. Unless we say otherwise, the
<strong>yamlet</strong> package will treat the first two un-named items
as ‘label’ (a short description) and ‘guide’ (a hint about how to
interpret the values). ‘guide’ might be units for continuous variables,
levels (and possibly labels) for categorical values, format strings for
dates and times, or perhaps something else.</p>
<p>The <strong>yamlet</strong> package gives you five ways of
controlling how data items are identified (see details for
<code>?as_yamlet.character</code>). The most direct way is to supply
explicit <code>yaml</code> keys:</p>
<pre><code>ID: [ label: subject identifier ]
CONC: [ label: concentration, guide: ng/mL ]</code></pre>
<p>We see that rather complex data can be expressed using only colons,
commas, and square brackets. <code>yaml</code> itself also uses curly
braces to express “maps”, but for purposes here they are
unnecessary.</p>
<p>Note above that we had to add square brackets for ‘ID’ when
introducing the second colon (can’t really have two colons at the same
level, so to speak). Note also that sequences can be nested arbitrarily
deep. We take advantage of this principle to transform ‘guide’ into a
set of categorical levels.</p>
<pre><code>ID: [ label: subject identifier ]
CONC: [ label: concentration, guide: ng/mL ]
RACE: [ label: race, guide: [ 0, 1, 2 ]]</code></pre>
<p>or more simply (taking advantage of default keys)</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]
RACE: [ race, [ 0, 1, 2 ]]</code></pre>
<p>So now we have ‘codes’ (levels) for our dataset that represent races.
What do these codes mean? We supply ‘decodes’ (labels) as keys.</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]
RACE: [ race, [ white: 0, black: 1, asian: 2 ]]</code></pre>
<p>Elegantly, <code>yaml</code> (and therefore <strong>yamlet</strong>)
gives us a way to represent a code even if we don’t know the decode,
<em>and</em> a way to represent a decode even though we don’t know the
code. Imagine a dataset is under collaborative development, and we
already know that there are some ‘RACE’ values of 0 but we’re not sure
what they mean. We also know that there will be some ‘asian’ race
values, but we haven’t assigned a code yet. We can write:</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]
RACE: [ race, [ 0, black: 1, ? asian ]]</code></pre>
</div>
<div id="automatic-method" class="section level3">
<h3>Automatic Method</h3>
<p>The whole point of this exercise (and I’m getting a little ahead of
myself) is to have some stored metadata that we can read into R and
apply to a data frame as column attributes. If typing square brackets
isn’t your thing, you can actually do this backwards by supplying column
attributes to a data frame and writing them out!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(dplyr))</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">library</span>(yamlet)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">ID =</span> <span class="dv">1</span>, </span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="at">CONC =</span> <span class="dv">1</span>,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="at">RACE =</span> <span class="dv">1</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>x<span class="sc">$</span>ID <span class="sc">%&lt;&gt;%</span> <span class="fu">structure</span>(<span class="at">label =</span> <span class="st">&#39;subject identifier&#39;</span>)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>x<span class="sc">$</span>CONC <span class="sc">%&lt;&gt;%</span> <span class="fu">structure</span>(<span class="at">label =</span> <span class="st">&#39;concentration&#39;</span>, <span class="at">guide =</span> <span class="st">&#39;ng/mL&#39;</span>)</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>x<span class="sc">$</span>RACE <span class="sc">%&lt;&gt;%</span> <span class="fu">structure</span>(<span class="at">label =</span> <span class="st">&#39;race&#39;</span>, <span class="at">guide =</span> <span class="fu">list</span>(<span class="at">white =</span> <span class="dv">0</span>, <span class="at">black =</span> <span class="dv">1</span>, <span class="at">asian =</span> <span class="dv">2</span>))</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>x <span class="sc">%&gt;%</span> as_yamlet <span class="sc">%&gt;%</span> as.character <span class="sc">%&gt;%</span> writeLines</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt; ID: subject identifier</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt; CONC: [ concentration, ng/mL ]</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; RACE: [ race, [ white: 0, black: 1, asian: 2 ]]</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>x <span class="sc">%&gt;%</span> as_yamlet <span class="sc">%&gt;%</span> as.character <span class="sc">%&gt;%</span> <span class="fu">writeLines</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&#39;drug.yaml&#39;</span>))</span></code></pre></div>
</div>
</div>
<div id="reading-and-binding-yamlet-in-r" class="section level2">
<h2>Reading and Binding Yamlet in R</h2>
<p>Let’s take advantage of that last example to show how we can read
<strong>yamlet</strong> into R.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">read_yamlet</span>(<span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&#39;drug.yaml&#39;</span>))</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>meta</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt; - ID</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt;  - label: subject identifier</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; - CONC</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt;  - label: concentration</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt;  - guide: ng/mL</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; - RACE</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">#&gt;  - label: race</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">#&gt;  - guide</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt;   - white: 0</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt;   - black: 1</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="co">#&gt;   - asian: 2</span></span></code></pre></div>
<p><code>meta</code> is just a named list of column attributes.
<code>decorate()</code> loads them onto columns of a data frame.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="dv">1</span>, <span class="at">CONC =</span> <span class="dv">1</span>, <span class="at">RACE =</span> <span class="dv">1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">decorate</span>(x, <span class="at">meta =</span> meta)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">decorations</span>(x)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; - ID</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt;  - label: subject identifier</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; - CONC</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt;  - label: concentration</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co">#&gt;  - guide: ng/mL</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#&gt; - RACE</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#&gt;  - label: race</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt;  - guide</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt;   - white: 0</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt;   - black: 1</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt;   - asian: 2</span></span></code></pre></div>
<p>If you like, you can skip the external file and decorate directly
with <code>yamlet</code> (instead of, say, structure() like we did
above).</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ID =</span> <span class="dv">1</span>, <span class="at">CONC =</span> <span class="dv">1</span>, <span class="at">RACE =</span> <span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">decorate</span>(x,<span class="st">&#39;</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="st">ID: subject identifier</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="st">CONC: [ concentration, ng/mL ]</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="st">RACE: [ race, [white: 0, black: 1, asian: 2 ]]</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="st">&#39;</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="fu">decorations</span>(x)</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; - ID</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt;  - label: subject identifier</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; - CONC</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="co">#&gt;  - label: concentration</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt;  - guide: ng/mL</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt; - RACE</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt;  - label: race</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt;  - guide</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt;   - white: 0</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt;   - black: 1</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt;   - asian: 2</span></span></code></pre></div>
</div>
<div id="extracting-and-writing-yamlet-to-storage" class="section level2">
<h2>Extracting and Writing Yamlet to Storage</h2>
<p>We saw earlier that <code>as_yamlet()</code> can pull “decorations”
off a data frame and present them as <strong>yamlet</strong>. this is
the default behavior of <code>decorations()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">decorations</span>(x)</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; - ID</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">#&gt;  - label: subject identifier</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; - CONC</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#&gt;  - label: concentration</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co">#&gt;  - guide: ng/mL</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a><span class="co">#&gt; - RACE</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co">#&gt;  - label: race</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a><span class="co">#&gt;  - guide</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a><span class="co">#&gt;   - white: 0</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt;   - black: 1</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt;   - asian: 2</span></span></code></pre></div>
<p><code>write_yamlet()</code> calls <code>as_yamlet()</code> on its
primary argument, and sends the result to a connection of our
choice.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&#39;out.yaml&#39;</span>)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">write_yamlet</span>(x, <span class="at">con =</span> file )</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>file <span class="sc">%&gt;%</span> readLines <span class="sc">%&gt;%</span> writeLines</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="co">#&gt; ID: subject identifier</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="co">#&gt; CONC: [ concentration, ng/mL ]</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="co">#&gt; RACE: [ race, [ white: 0, black: 1, asian: 2 ]]</span></span></code></pre></div>
</div>
<div id="coordinated-input-and-output" class="section level2">
<h2>Coordinated Input and Output</h2>
<p>A useful convention is to store metadata in a file next to the file
it describes, with the same name but the ‘yaml’ extension.
<code>decorate()</code> expects this, and if given a file path to a CSV
file, it will look for a ’*.yaml’ file nearby. To “decorate” a CSV path
means to read it, read its <code>yamlet</code> (if any) and apply the
<code>yamlet</code> as attributes on the resulting data frame.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">library</span>(csv)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="co"># see ?Quinidine in package nlme</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&#39;yamlet&#39;</span>, <span class="st">&#39;extdata&#39;</span>,<span class="st">&#39;quinidine.csv&#39;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">decorate</span>(file)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="fu">as_yamlet</span>(a)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co">#&gt; - Subject</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a><span class="co">#&gt;  - label: patient identifier</span></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a><span class="co">#&gt; - time</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a><span class="co">#&gt;  - label: time since start of study</span></span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co">#&gt;  - guide: h</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a><span class="co">#&gt; - conc</span></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co">#&gt;  - label: quinidine serum concentration</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co">#&gt;  - guide: mg/L</span></span></code></pre></div>
<p>Another way to achieve the same thing is with <code>io_csv()</code>.
It is a toggle function that returns a path if given a file to store,
and returns a decorated data frame if given a path to read (same for
<code>io_table()</code>, which has all the formatting options of
<code>read.table()</code> and <code>write.table()</code>). The path is
just the path to the primary data, but the path to the metadata is
implied as well.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">csv_source =</span> <span class="cn">FALSE</span>) <span class="co"># see ?as.csv</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&#39;yamlet&#39;</span>, <span class="st">&#39;extdata&#39;</span>,<span class="st">&#39;quinidine.csv&#39;</span>)</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">decorate</span>(file)</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">&#39;out.csv&#39;</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="fu">io_csv</span>(x, out)</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">io_csv</span>(out)</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="fu">identical</span>(x, y) <span class="co"># lossless &#39;round-trip&#39;</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="fu">file.exists</span>(out)</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">&#39;csv&#39;</span>,<span class="st">&#39;yaml&#39;</span>, out)</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="fu">file.exists</span>(meta)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>meta <span class="sc">%&gt;%</span> readLines <span class="sc">%&gt;%</span> head <span class="sc">%&gt;%</span> writeLines</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="co">#&gt; Subject: patient identifier</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="co">#&gt; time: [ time since start of study, h ]</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a><span class="co">#&gt; conc: [ quinidine serum concentration, mg/L ]</span></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="co">#&gt; dose: [ quinidine administered dose, mg ]</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="co">#&gt; interval: [ inter-dose interval, h ]</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="co">#&gt; Age: [ baseline subject age, year ]</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a><span class="fu">options</span>(<span class="at">csv_source =</span> <span class="cn">TRUE</span>) <span class="co"># restore</span></span></code></pre></div>
</div>
<div id="using-yamlet-metadata" class="section level2">
<h2>Using Yamlet Metadata</h2>
<p>Metadata can be used prospectively or retrospectively. Early in the
data life cycle, it can be used prospectively to guide table development
in a collaborative setting (i.e. as a data specification). Later in the
life cycle, metadata can be used retrospectively to consistently inform
report elements such as figures and tables.</p>
<div id="example-figure" class="section level3">
<h3>Example Figure</h3>
<p>For example, The <strong>yamlet</strong> package provides an
experimental wrapper for ggplot that uses column attributes to
automatically generate informative axis labels and legends.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">library</span>(ggplot2))</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>file <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&#39;yamlet&#39;</span>, <span class="st">&#39;extdata&#39;</span>,<span class="st">&#39;quinidine.csv&#39;</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>file <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>  decorate <span class="sc">%&gt;%</span> </span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(conc)) <span class="sc">%&gt;%</span> </span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  resolve <span class="sc">%&gt;%</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> conc, <span class="at">color =</span> Heart)) <span class="sc">+</span> </span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<div class="float">
<img src="data:image/png;base64,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" alt="Automatic axis labels and legends using curated metadata as column attributes." />
<div class="figcaption">Automatic axis labels and legends using curated
metadata as column attributes.</div>
</div>
</div>
<div id="example-table" class="section level3">
<h3>Example Table</h3>
<p>The <strong>table1</strong> package uses labels and units stored as
attributes to enrich table output. In the example below, we use
<code>resolve()</code> to re-implement guides as units and factor
levels, which is what <code>table1()</code> needs.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(table1))</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>file <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  decorate <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  resolve <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>  <span class="fu">group_by</span>(Subject) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>  <span class="fu">table1</span>(<span class="sc">~</span> Age <span class="sc">+</span> Weight <span class="sc">+</span> Race <span class="sc">|</span> Heart, .)</span></code></pre></div>
<div class="Rtable1"><table class="Rtable1">
<thead>
<tr>
<th class="rowlabel firstrow lastrow"></th>
<th class="firstrow lastrow"><span class="stratlabel">No/Mild<br><span class="stratn">(N=56)</span></span></th>
<th class="firstrow lastrow"><span class="stratlabel">Moderate<br><span class="stratn">(N=40)</span></span></th>
<th class="firstrow lastrow"><span class="stratlabel">Severe<br><span class="stratn">(N=40)</span></span></th>
<th class="firstrow lastrow"><span class="stratlabel">Overall<br><span class="stratn">(N=136)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class="rowlabel firstrow">baseline subject age (year)</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">Mean (SD)</td>
<td>67.1 (8.32)</td>
<td>67.9 (10.1)</td>
<td>65.5 (8.48)</td>
<td>66.9 (8.91)</td>
</tr>
<tr>
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">68.0 [50.0, 87.0]</td>
<td class="lastrow">65.5 [46.0, 92.0]</td>
<td class="lastrow">64.0 [42.0, 88.0]</td>
<td class="lastrow">66.0 [42.0, 92.0]</td>
</tr>
<tr>
<td class="rowlabel firstrow">subject body weight (kg)</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">Mean (SD)</td>
<td>81.7 (16.9)</td>
<td>78.6 (13.4)</td>
<td>77.6 (15.9)</td>
<td>79.6 (15.6)</td>
</tr>
<tr>
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">80.0 [41.0, 119]</td>
<td class="lastrow">80.0 [55.0, 106]</td>
<td class="lastrow">74.0 [47.0, 112]</td>
<td class="lastrow">79.0 [41.0, 119]</td>
</tr>
<tr>
<td class="rowlabel firstrow">subject race</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr>
<td class="rowlabel">Caucasian</td>
<td>40 (71.4%)</td>
<td>26 (65.0%)</td>
<td>25 (62.5%)</td>
<td>91 (66.9%)</td>
</tr>
<tr>
<td class="rowlabel">Latin</td>
<td>13 (23.2%)</td>
<td>12 (30.0%)</td>
<td>10 (25.0%)</td>
<td>35 (25.7%)</td>
</tr>
<tr>
<td class="rowlabel lastrow">Black</td>
<td class="lastrow">3 (5.4%)</td>
<td class="lastrow">2 (5.0%)</td>
<td class="lastrow">5 (12.5%)</td>
<td class="lastrow">10 (7.4%)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="caveat" class="section level2">
<h2>Caveat</h2>
<p>It is a well-known problem that many table manipulations in R cause
column attributes to be dropped. Binding of metadata is best done at a
point in a workflow where few or no such manipulations remain. Else,
precautions should be taken to preserve or restore attributes as
necessary.</p>
</div>
<div id="reminder" class="section level2">
<h2>Reminder</h2>
<p>Remember to quote a literal value of yes, no, y, n, true false, on,
off, or any of these capitalized, or any of these as all-caps. Otherwise
they will be converted to TRUE or FALSE per the usual rules for
yaml.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>The <strong>yamlet</strong> package implements a metadata storage
syntax that is easy to write, read, and bind to data frame columns.
Systematic curation of metadata enriches and simplifies efforts to
create and describe tables stored in flat files. Conforming tools can
take advantage of internal and external <strong>yamlet</strong>
representations to enhance data development and reporting.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
