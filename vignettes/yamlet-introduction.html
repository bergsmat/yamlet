<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Tim Bergsma" />

<meta name="date" content="2020-01-10" />

<title>An Introduction to Yamlet</title>

<style type="text/css">.Rtable1 table, table.Rtable1 {font-family: "Arial", Arial, sans-serif;font-size: 10pt;border-collapse: collapse;padding: 0px;margin: 0px;}.Rtable1 td {white-space:nowrap;}.Rtable1 th, .Rtable1 td {border: 0;text-align: center;padding: 0.5ex 1.5ex;margin: 0px;}.Rtable1 thead>tr:first-child>th {border-top: 2pt solid black;}.Rtable1 thead>tr:last-child>th {border-bottom: 1pt solid black;}.Rtable1 tbody>tr:last-child>td {border-bottom: 2pt solid black;}.Rtable1 th.grouplabel {padding-left: 0;padding-right: 0;}.Rtable1 th.grouplabel>div {margin-left: 1.5ex;margin-right: 1.5ex;border-bottom: 1pt solid black;}.Rtable1 th.grouplabel:last-child>div {margin-right: 0;}.Rtable1 .rowlabel {text-align: left;padding-left: 2.5ex;}.Rtable1 .firstrow.rowlabel {padding-left: 0.5ex;font-weight: bold;}.Rtable1-zebra tbody tr:nth-child(odd) {background-color: #eee;}table.Rtable1-times {font-family: "Times New Roman", Times, serif;}.Rtable1-shade th {background-color: #ccc;}.Rtable1-grid th, .Rtable1-grid td {border-left: 1pt solid black;border-right: 1pt solid black;}.Rtable1-grid thead>tr:first-child>th {border-top: 1pt solid black;}.Rtable1-grid thead>tr:last-child>th {border-bottom: 1pt solid black;}.Rtable1-grid tbody>tr:last-child>td {border-bottom: 1pt solid black;}.Rtable1-grid .firstrow, .Rtable1-grid .firstrow ~ td {border-top: 1pt solid black;}.Rtable1-grid th.grouplabel>div {margin-left: 0;margin-right: 0;border-bottom: 0;}.Rtable1-center td.rowlabel, .Rtable1-center td.firstrow.rowlabel {font-weight: bold;text-align: center;padding: 0.5ex 1.5ex;}.Rtable1-footnote {font-size: smaller;padding: 0px;margin: 0px;}</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">An Introduction to Yamlet</h1>
<h4 class="author">Tim Bergsma</h4>
<h4 class="date">2020-01-10</h4>


<div id="TOC">
<ul>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#writing-yamlet">Writing Yamlet</a><ul>
<li><a href="#manual-method">Manual Method</a></li>
<li><a href="#automatic-method">Automatic Method</a></li>
</ul></li>
<li><a href="#reading-and-binding-yamlet-in-r">Reading and Binding Yamlet in R</a></li>
<li><a href="#extracting-and-writing-yamlet-to-storage">Extracting and Writing Yamlet to Storage</a></li>
<li><a href="#coordinated-input-and-output">Coordinated Input and Output</a></li>
<li><a href="#using-yamlet-metadata">Using Yamlet Metadata</a><ul>
<li><a href="#example-figure">Example Figure</a></li>
<li><a href="#example-table">Example Table</a></li>
</ul></li>
<li><a href="#caveat">Caveat</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>

<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>R datasets of modest size are routinely stored as flat files and retrieved as data frames. Unfortunately, the classic storage formats (comma delimited, tab delimited) do not have obvious mechanisms for storing data <em>about</em> the data: i.e., metadata such as column labels, units, and meanings of categorical codes. In many cases we hold such information in our heads and hard-code it in our scripts as axis labels, figure legends, or table enhancements. That’s probably fine for simple cases but does not scale well in production settings where the same metadata is re-used extensively. Is there a better way to store, retrieve, and bind table metadata for consistent reuse?</p>
</div>
<div id="writing-yamlet" class="section level2">
<h2>Writing Yamlet</h2>
<p><strong>yamlet</strong> is a storage format for table metadata, implemented as an R package.<br />
It was designed to be:</p>
<ul>
<li>easy to edit</li>
<li>easy to import</li>
<li>open-ended</li>
</ul>
<p>Although intended mainly to document (or pre-specify!) data column labels and units, there are few restrictions on the types of metadata that can be stored. In fact, the only real restriction is that the stored form must be valid <a href="https://yaml.org/spec/1.2/spec.html">yaml</a>. Below, we use <strong>yamlet</strong> to indicate the paradigm or package, and <code>yamlet</code> to indicate stored instances.</p>
<div id="manual-method" class="section level3">
<h3>Manual Method</h3>
<p>Actually, <code>yamlet</code> (think: “just a little yaml”) is a special case of <code>yaml</code> that stores column attributes in one record per column. For instance, to store the fact that data for an imaginary drug trial has a column called ‘ID’, pop open a text file and write</p>
<pre><code>ID:</code></pre>
<p>This in itself is valid <code>yaml</code>! But if you know a label to go with ID, you can add it:</p>
<pre><code>ID: subject identifier</code></pre>
<p>If you have (or expect) a second column with units, you can add it below.</p>
<pre><code>ID: subject identifier
CONC: concentration, ng/mL</code></pre>
<p>A couple of notes here.</p>
<ul>
<li>The first thing after a colon must be a space.</li>
<li>Whatever follows the colon-space is only One Thing.</li>
<li>That One Thing could be a <em>sequence</em> of Many Things.</li>
</ul>
<p>To get a sequence, just add square brackets. For instance, above we have said that ‘CONC’ has the label ‘concentration, ng/mL’ but what we really intend is that it has label ‘concentration’ and unit ‘ng/mL’ so we rewrite it as</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]</code></pre>
<p>Now label and units are two different things. Notice we have not explicitly named them. Unless we say otherwise, the <strong>yamlet</strong> package will treat the first two un-named items as ‘label’ (a short description) and ‘guide’ (a hint about how to interpret the values). ‘guide’ might be units for continuous variables, levels (and possibly labels) for categorical values, format strings for dates and times, or perhaps something else.</p>
<p>The <strong>yamlet</strong> package gives you five ways of controlling how data items are identified. The most direct way is to supply explicit <code>yaml</code> keys:</p>
<pre><code>ID: [ label: subject identifier ]
CONC: [ label: concentration, guide: ng/mL ]</code></pre>
<p>We see that rather complex data can be expressed using only colons, commas, and square brackets. <code>yaml</code> itself also uses curly braces to express “maps”, but for purposes here they are unnecessary.</p>
<p>Note above that we had to add square brackets for ‘ID’ when introducing the second colon (can’t really have two colons at the same level, so to speak). Note also that sequences can be nested arbitrarily deep. We take advantage of this principle to transform ‘guide’ into a set of categorical levels.</p>
<pre><code>ID: [ label: subject identifier ]
CONC: [ label: concentration, guide: ng/mL ]
RACE: [ label: race, guide: [ 0, 1, 2 ]]</code></pre>
<p>or more simply (taking advantage of default keys)</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]
RACE: [ race, [ 0, 1, 2 ]]</code></pre>
<p>So now we have ‘codes’ (levels) for our dataset that represent races. What do these codes mean? We supply ‘decodes’ (labels) as keys.</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]
RACE: [ race, [ white: 0, black: 1, asian: 2 ]]</code></pre>
<p>Elegantly, <code>yaml</code> (and therefore <strong>yamlet</strong>) gives us a way to represent a code even if we don’t know the decode, <em>and</em> a way to represent a decode even though we don’t know the code. Imagine a dataset is under collaborative development, and we already know that there are some ‘RACE’ values of 0 but we’re not sure what they mean. We also know that there will be some ‘asian’ race values, but we haven’t assigned a code yet. We can write:</p>
<pre><code>ID: subject identifier
CONC: [ concentration, ng/mL ]
RACE: [ race, [ 0, black: 1, ? asian ]]</code></pre>
</div>
<div id="automatic-method" class="section level3">
<h3>Automatic Method</h3>
<p>The whole point of this exercise (and I’m getting a little ahead of myself) is to have some stored metadata that we can read into R and apply to a data frame as column attributes. If typing square brackets isn’t your thing, you can actually do this backwards by supplying column attributes to a data frame and writing them out!</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(dplyr))</a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">library</span>(yamlet)</a>
<a class="sourceLine" id="cb10-4" title="4">x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="dt">ID =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="dt">CONC =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb10-7" title="7">  <span class="dt">RACE =</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb10-8" title="8">)</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10">x<span class="op">$</span>ID <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">structure</span>(<span class="dt">label =</span> <span class="st">&#39;subject identifier&#39;</span>)</a>
<a class="sourceLine" id="cb10-11" title="11">x<span class="op">$</span>CONC <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">structure</span>(<span class="dt">label =</span> <span class="st">&#39;concentration&#39;</span>, <span class="dt">guide =</span> <span class="st">&#39;ng/mL&#39;</span>)</a>
<a class="sourceLine" id="cb10-12" title="12">x<span class="op">$</span>RACE <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">structure</span>(<span class="dt">label =</span> <span class="st">&#39;race&#39;</span>, <span class="dt">guide =</span> <span class="kw">list</span>(<span class="dt">white =</span> <span class="dv">0</span>, <span class="dt">black =</span> <span class="dv">1</span>, <span class="dt">asian =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb10-13" title="13"></a>
<a class="sourceLine" id="cb10-14" title="14">x <span class="op">%&gt;%</span><span class="st"> </span>as_yamlet <span class="op">%&gt;%</span><span class="st"> </span>as.character <span class="op">%&gt;%</span><span class="st"> </span>writeLines</a>
<a class="sourceLine" id="cb10-15" title="15"><span class="co">#&gt; ID: subject identifier</span></a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt; CONC: [ concentration, ng/mL ]</span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; RACE: [ race, [ white: 0, black: 1, asian: 2 ]]</span></a>
<a class="sourceLine" id="cb10-18" title="18"></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co"># or</span></a>
<a class="sourceLine" id="cb10-20" title="20"></a>
<a class="sourceLine" id="cb10-21" title="21">x <span class="op">%&gt;%</span><span class="st"> </span>as_yamlet <span class="op">%&gt;%</span><span class="st"> </span>as.character <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">writeLines</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&#39;drug.yaml&#39;</span>))</a></code></pre></div>
</div>
</div>
<div id="reading-and-binding-yamlet-in-r" class="section level2">
<h2>Reading and Binding Yamlet in R</h2>
<p>Let’s take advantage of that last example to show how we can read <strong>yamlet</strong> into R.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">meta &lt;-<span class="st"> </span><span class="kw">read_yamlet</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&#39;drug.yaml&#39;</span>))</a>
<a class="sourceLine" id="cb11-2" title="2">meta</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co">#&gt; - ID</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">#&gt;  - label: subject identifier</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="co">#&gt; - CONC</span></a>
<a class="sourceLine" id="cb11-6" title="6"><span class="co">#&gt;  - label: concentration</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="co">#&gt;  - guide: ng/mL</span></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co">#&gt; - RACE</span></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="co">#&gt;  - label: race</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co">#&gt;  - guide</span></a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt;   - white: 0</span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt;   - black: 1</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt;   - asian: 2</span></a></code></pre></div>
<p><code>meta</code> is just a named list of column attributes. <code>decorate()</code> loads them onto columns of a data frame.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">x &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ID =</span> <span class="dv">1</span>, <span class="dt">CONC =</span> <span class="dv">1</span>, <span class="dt">RACE =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-2" title="2">x &lt;-<span class="st"> </span><span class="kw">decorate</span>(x, meta)</a>
<a class="sourceLine" id="cb12-3" title="3"><span class="kw">str</span>(x)</a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt; &#39;data.frame&#39;:    1 obs. of  3 variables:</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt;  $ ID  : num 1</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt;   ..- attr(*, &quot;label&quot;)= chr &quot;subject identifier&quot;</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt;  $ CONC: num 1</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt;   ..- attr(*, &quot;label&quot;)= chr &quot;concentration&quot;</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt;   ..- attr(*, &quot;guide&quot;)= chr &quot;ng/mL&quot;</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt;  $ RACE: num 1</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt;   ..- attr(*, &quot;label&quot;)= chr &quot;race&quot;</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt;   ..- attr(*, &quot;guide&quot;)=List of 3</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt;   .. ..$ white: int 0</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt;   .. ..$ black: int 1</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt;   .. ..$ asian: int 2</span></a></code></pre></div>
</div>
<div id="extracting-and-writing-yamlet-to-storage" class="section level2">
<h2>Extracting and Writing Yamlet to Storage</h2>
<p>We saw earlier that <code>as_yamlet()</code> can pull “decorations” off a data frame and present them as <strong>yamlet</strong>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="co"># decorations(x) # just a list</span></a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw">as_yamlet</span>(x) <span class="co"># a list with class &#39;yamlet&#39; (special print method)</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#&gt; - ID</span></a>
<a class="sourceLine" id="cb13-4" title="4"><span class="co">#&gt;  - label: subject identifier</span></a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt; - CONC</span></a>
<a class="sourceLine" id="cb13-6" title="6"><span class="co">#&gt;  - label: concentration</span></a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt;  - guide: ng/mL</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt; - RACE</span></a>
<a class="sourceLine" id="cb13-9" title="9"><span class="co">#&gt;  - label: race</span></a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt;  - guide</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt;   - white: 0</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt;   - black: 1</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt;   - asian: 2</span></a></code></pre></div>
<p><code>write_yamlet()</code> calls <code>as_yamlet()</code> on its primary argument, and sends the result to a connection of our choice.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">file &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&#39;out.yaml&#39;</span>)</a>
<a class="sourceLine" id="cb14-2" title="2"><span class="kw">write_yamlet</span>(x, file )</a>
<a class="sourceLine" id="cb14-3" title="3">file <span class="op">%&gt;%</span><span class="st"> </span>readLines <span class="op">%&gt;%</span><span class="st"> </span>writeLines</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co">#&gt; ID: subject identifier</span></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="co">#&gt; CONC: [ concentration, ng/mL ]</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="co">#&gt; RACE: [ race, [ white: 0, black: 1, asian: 2 ]]</span></a></code></pre></div>
</div>
<div id="coordinated-input-and-output" class="section level2">
<h2>Coordinated Input and Output</h2>
<p>A useful convention is to store metadata in a file next to the file it describes, with the same name but the ‘yaml’ extension. <code>decorate()</code> expects this, and if given a file path to a CSV file, it will look for a ’*.yaml’ file nearby. To “decorate” a CSV path means to read it, read its <code>yamlet</code> (if any) and apply the <code>yamlet</code> as attributes on the resulting data frame.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">library</span>(csv)</a>
<a class="sourceLine" id="cb15-2" title="2"><span class="co"># see ?Quinidine in package nlme</span></a>
<a class="sourceLine" id="cb15-3" title="3">file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package =</span> <span class="st">&#39;yamlet&#39;</span>, <span class="st">&#39;extdata&#39;</span>,<span class="st">&#39;quinidine.csv&#39;</span>)</a>
<a class="sourceLine" id="cb15-4" title="4">a &lt;-<span class="st"> </span><span class="kw">decorate</span>(file)</a>
<a class="sourceLine" id="cb15-5" title="5"><span class="kw">as_yamlet</span>(a)[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>]</a>
<a class="sourceLine" id="cb15-6" title="6"><span class="co">#&gt; - Subject</span></a>
<a class="sourceLine" id="cb15-7" title="7"><span class="co">#&gt;  - label: patient identifier</span></a>
<a class="sourceLine" id="cb15-8" title="8"><span class="co">#&gt; - time</span></a>
<a class="sourceLine" id="cb15-9" title="9"><span class="co">#&gt;  - label: time since start of study</span></a>
<a class="sourceLine" id="cb15-10" title="10"><span class="co">#&gt;  - guide: h</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="co">#&gt; - conc</span></a>
<a class="sourceLine" id="cb15-12" title="12"><span class="co">#&gt;  - label: quinidine serum concentration</span></a>
<a class="sourceLine" id="cb15-13" title="13"><span class="co">#&gt;  - guide: mg/L</span></a></code></pre></div>
<p>Another way to achieve the same thing is with <code>io_csv()</code>. It is a toggle function that returns a path if given a file to store, and returns a decorated data frame if given a path to read (same for <code>io_table()</code>, which has all the formatting options of <code>read.table()</code> and <code>write.table()</code>). The path is just the path to the primary data, but the path to the metadata is implied as well.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package =</span> <span class="st">&#39;yamlet&#39;</span>, <span class="st">&#39;extdata&#39;</span>,<span class="st">&#39;quinidine.csv&#39;</span>)</a>
<a class="sourceLine" id="cb16-2" title="2">x &lt;-<span class="st"> </span><span class="kw">decorate</span>(file)</a>
<a class="sourceLine" id="cb16-3" title="3">out &lt;-<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">&#39;out.csv&#39;</span>)</a>
<a class="sourceLine" id="cb16-4" title="4"><span class="kw">io_csv</span>(x, out)</a>
<a class="sourceLine" id="cb16-5" title="5">y &lt;-<span class="st"> </span><span class="kw">io_csv</span>(out)</a>
<a class="sourceLine" id="cb16-6" title="6"><span class="kw">attr</span>(x, <span class="st">&#39;source&#39;</span>) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="kw">attr</span>(y, <span class="st">&#39;source&#39;</span>) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="kw">identical</span>(x, y) <span class="co"># lossless &#39;round-trip&#39;</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="kw">file.exists</span>(out)</a>
<a class="sourceLine" id="cb16-11" title="11"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb16-12" title="12">meta &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&#39;csv&#39;</span>,<span class="st">&#39;yaml&#39;</span>, out)</a>
<a class="sourceLine" id="cb16-13" title="13"><span class="kw">file.exists</span>(meta)</a>
<a class="sourceLine" id="cb16-14" title="14"><span class="co">#&gt; [1] TRUE</span></a>
<a class="sourceLine" id="cb16-15" title="15">meta <span class="op">%&gt;%</span><span class="st"> </span>readLines <span class="op">%&gt;%</span><span class="st"> </span>head <span class="op">%&gt;%</span><span class="st"> </span>writeLines</a>
<a class="sourceLine" id="cb16-16" title="16"><span class="co">#&gt; Subject: patient identifier</span></a>
<a class="sourceLine" id="cb16-17" title="17"><span class="co">#&gt; time: [ time since start of study, h ]</span></a>
<a class="sourceLine" id="cb16-18" title="18"><span class="co">#&gt; conc: [ quinidine serum concentration, mg/L ]</span></a>
<a class="sourceLine" id="cb16-19" title="19"><span class="co">#&gt; dose: [ quinidine administered dose, mg ]</span></a>
<a class="sourceLine" id="cb16-20" title="20"><span class="co">#&gt; interval: [ inter-dose interval, h ]</span></a>
<a class="sourceLine" id="cb16-21" title="21"><span class="co">#&gt; Age: [ baseline subject age, &#39;y&#39; ]</span></a></code></pre></div>
</div>
<div id="using-yamlet-metadata" class="section level2">
<h2>Using Yamlet Metadata</h2>
<p>An early use of metadata is to guide table development in a collaborative setting (i.e. as a data specification). In contrast with this prospective use is the retrospective use of metadata for reporting. Curated metadata, appropriately associated with primary data, can enrich output such as tables and figures consistently.</p>
<div id="example-figure" class="section level3">
<h3>Example Figure</h3>
<p>For example, The <strong>yamlet</strong> package provides an experimental wrapper for ggplot that uses column attributes to automatically generate informative axis labels and legends.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw">suppressWarnings</span>(<span class="kw">library</span>(ggplot2))</a>
<a class="sourceLine" id="cb17-2" title="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb17-4" title="4">file &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package =</span> <span class="st">&#39;yamlet&#39;</span>, <span class="st">&#39;extdata&#39;</span>,<span class="st">&#39;quinidine.csv&#39;</span>)</a>
<a class="sourceLine" id="cb17-5" title="5"></a>
<a class="sourceLine" id="cb17-6" title="6">file <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="st">  </span>decorate <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-8" title="8"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(conc)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-9" title="9"><span class="st">  </span><span class="kw">agplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> conc, <span class="dt">color =</span> Heart)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<div class="figure">
<img src="data:image/png;base64,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" alt="Automatic axis labels and legends using curated metadata as column attributes." />
<p class="caption">Automatic axis labels and legends using curated metadata as column attributes.</p>
</div>
</div>
<div id="example-table" class="section level3">
<h3>Example Table</h3>
<p>The <strong>table1</strong> package uses labels and units stored as attributes to enrich table output. In the example below, we read attributes twice: once to get ‘guide’ as ‘guide’ so that <code>coerce</code> will factorize ‘Heart’, and again to get ‘guide’ as ‘units’ (technically wrong for categorical items) which is what <code>table1()</code> needs.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">suppressMessages</span>(<span class="kw">library</span>(table1))</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co">#&gt; Warning: package &#39;table1&#39; was built under R version 3.6.2</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="kw">options</span>(<span class="dt">yamlet_overwrite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-4" title="4">file <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="st">  </span>as.csv <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="st">  </span><span class="kw">decorate</span>(<span class="dt">coerce =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># factor if length(guide) &gt; 1</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="st">  </span><span class="kw">decorate</span>(<span class="dt">default =</span> <span class="kw">c</span>(<span class="st">&#39;label&#39;</span>,<span class="st">&#39;units&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># code guide as units</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="st">  </span><span class="kw">group_by</span>(Subject) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-9" title="9"><span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb18-10" title="10"><span class="st">  </span><span class="kw">table1</span>(<span class="op">~</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Weight <span class="op">+</span><span class="st"> </span>Race <span class="op">|</span><span class="st"> </span>Heart, .)</a></code></pre></div>
<div class="Rtable1"><table class="Rtable1">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>No/Mild<br><span class='stratn'>(n=56)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Moderate<br><span class='stratn'>(n=40)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Severe<br><span class='stratn'>(n=40)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br><span class='stratn'>(n=136)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>baseline subject age<span class='varunits'> (y)</span></span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>67.1 (8.32)</td>
<td>67.9 (10.1)</td>
<td>65.5 (8.48)</td>
<td>66.9 (8.91)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>68.0 [50.0, 87.0]</td>
<td class='lastrow'>65.5 [46.0, 92.0]</td>
<td class='lastrow'>64.0 [42.0, 88.0]</td>
<td class='lastrow'>66.0 [42.0, 92.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>subject body weight<span class='varunits'> (kg)</span></span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>81.7 (16.9)</td>
<td>78.6 (13.4)</td>
<td>77.6 (15.9)</td>
<td>79.6 (15.6)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>80.0 [41.0, 119]</td>
<td class='lastrow'>80.0 [55.0, 106]</td>
<td class='lastrow'>74.0 [47.0, 112]</td>
<td class='lastrow'>79.0 [41.0, 119]</td>
</tr>
<tr>
<td class='rowlabel firstrow'><span class='varlabel'>Race</span></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Caucasian</td>
<td>40 (71.4%)</td>
<td>26 (65.0%)</td>
<td>25 (62.5%)</td>
<td>91 (66.9%)</td>
</tr>
<tr>
<td class='rowlabel'>Latin</td>
<td>13 (23.2%)</td>
<td>12 (30.0%)</td>
<td>10 (25.0%)</td>
<td>35 (25.7%)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Black</td>
<td class='lastrow'>3 (5.4%)</td>
<td class='lastrow'>2 (5.0%)</td>
<td class='lastrow'>5 (12.5%)</td>
<td class='lastrow'>10 (7.4%)</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="caveat" class="section level2">
<h2>Caveat</h2>
<p>It is a well-known problem that many table manipulations in R cause column attributes to be dropped. Binding of metadata is best done at a point in a workflow where few or no such manipulations remain. Else, precautions should be taken to preserve or restore attributes as necessary.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>The <strong>yamlet</strong> package implements a metadata storage syntax that is easy to write, read, and bind to data frame columns. Systematic curation of metadata enriches and simplifies efforts to create and describe tables stored in flat files. Conforming tools can take advantage of internal and external <strong>yamlet</strong> representations to enhance data development and reporting.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
